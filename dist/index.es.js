import*as e from"react";import{useState as t,useEffect as n,useMemo as r,useCallback as i}from"react";var o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{d(r.next(e))}catch(e){o(e)}}function s(e){try{d(r.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}d((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var c=function(e,t){return"".concat(e*t,"px")},h=function(e){return e&&"[object Function]"==={}.toString.call(e)},p={childrenKey:"children",classes:{},depthGap:20,displayedName:function(e){return e.data.name},filter:function(){return!0},gapMode:"margin",horizontalLineStyles:{stroke:"black",strokeWidth:1,strokeDasharray:"1 1"},idKey:"id",opened:[],verticalLineOffset:5,verticalLineStyles:{stroke:"black",strokeWidth:1,strokeDasharray:"1 1"},verticalLineTopOffset:0},u=function(e){return Object.keys(e).filter((function(t){return!!e[t]})).reduce((function(e,t){return e?"".concat(e).concat(t?" ".concat(t):""):"".concat(t)}),"")},f=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[0]&&"string"==typeof e[0]?e.join(" "):u(e[0])};function g(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var y="ht_hyperNodeArrowIcon",v="ht_opened";g(".ht_hyperNodeArrowIcon {\n  transition: transform 0.1s ease;\n  cursor: pointer;\n  margin-right: 4px; }\n  .ht_hyperNodeArrowIcon.ht_opened {\n    transform: rotate(90deg); }\n");var m=function(t){var n,r=t.onClick,i=t.opened;return e.createElement("svg",{className:f((n={},n[y]=!0,n[v]=!!i,n)),xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",onClick:r},e.createElement("path",{d:"M5 3l3.057-3 11.943 12-11.943 12-3.057-3 9-9z"}))},C="ht_loadingSpinner";g(".ht_loadingSpinner {\n  animation: ht_ht-loading-spinner 1s linear infinite;\n  margin-right: 4px; }\n\n@keyframes ht_ht-loading-spinner {\n  from {\n    transform: rotate(0deg); }\n  to {\n    transform: rotate(360deg); } }\n");var b=function(){return e.createElement("div",{className:C},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 48 48"},e.createElement("g",{fill:"none"},e.createElement("path",{id:"track",fill:"#C6CCD2",d:"M24,48 C10.745166,48 0,37.254834 0,24 C0,10.745166 10.745166,0 24,0\r\n        C37.254834,0 48,10.745166 48,24 C48,37.254834 37.254834,48 24,48 Z M24,44\r\n        C35.045695,44 44,35.045695 44,24 C44,12.954305 35.045695,4 24,4\r\n        C12.954305,4 4,12.954305 4,24 C4,35.045695 12.954305,44 24,44 Z"}),e.createElement("path",{id:"section",fill:"#3F4850",d:"M24,0 C37.254834,0 48,10.745166 48,24 L44,24 C44,12.954305 35.045695,4 24,4 L24,0 Z"}))))},N="ht_hyperNode";g(".ht_hyperNode {\n  display: flex;\n  align-items: center; }\n");var _=function(t){var n=t.displayedName,r=void 0===n?p.displayedName:n,i=t.node,o=t.onSelect,a=t.onToggle;return e.createElement("div",{className:N,onClick:o},(i.hasChildren()||i.options.async)&&!i.isLoading()&&e.createElement(m,{onClick:a,opened:i.isOpened()&&!!i.hasChildren()}),i.isLoading()&&e.createElement(b,null),e.createElement("div",null,h(r)?r(i):i.data[r]))},D="ht_verticalLine",L="ht_verticalSvgLine";g(".ht_verticalLine {\n  position: absolute;\n  top: 0;\n  transition: all 0.2s ease; }\n  .ht_verticalLine .ht_verticalSvgLine {\n    transition: all 0.2s ease; }\n");var O=function(t){var n=t.depth,r=t.depthGap,i=t.count,o=t.nodeHeight,a=t.disableTransitions,s=t.verticalLineOffset,d=void 0===s?p.verticalLineOffset:s,l=t.verticalLineStyles,h=void 0===l?p.verticalLineStyles:l,u=t.verticalLineTopOffset,f=void 0===u?p.verticalLineTopOffset:u;return e.createElement("div",{className:D,style:{left:"".concat(d,"px"),marginLeft:c(n,r),top:"".concat(f,"px")}},e.createElement("svg",{style:{height:"".concat(Math.floor(i*o-(o?o/2:0))-f,"px"),width:"".concat(h.strokeWidth,"px"),position:"absolute",transition:a?"none":"all 0.2s ease"}},e.createElement("line",{x1:"0%",y1:"0%",x2:"0%",y2:"100%",className:L,style:h})))},E="ht_horizontalLine";g(".ht_horizontalLine {\n  position: absolute;\n  top: 0;\n  display: flex;\n  align-items: center;\n  height: 100%; }\n");var w=function(t){var n=t.depth,r=t.depthGap,i=t.verticalLineOffset,o=void 0===i?p.verticalLineOffset:i,a=t.horizontalLineStyles,s=void 0===a?p.horizontalLineStyles:a,d=t.gapMode;return e.createElement("div",{className:E,style:{width:"".concat(r-o,"px"),left:"".concat("padding"===d?o-r+n*r:o-r,"px")}},e.createElement("svg",{style:{height:"".concat(s.strokeWidth,"px"),width:"100%"}},e.createElement("line",{x1:"0%",y1:"0%",x2:"100%",y2:"0%",style:s})))},S={dragZone:"ht_dragZone",dragZoneItem:"ht_dragZoneItem",dragZoneItemSelected:"ht_dragZoneItemSelected"};g(".ht_dragZone {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  visibility: hidden;\n  opacity: 0; }\n  .ht_dragZone:hover {\n    visibility: visible;\n    opacity: 1; }\n  .ht_dragZone .ht_dragZoneItem {\n    width: 100%;\n    height: 100%;\n    position: relative; }\n    .ht_dragZone .ht_dragZoneItem::after {\n      content: '';\n      display: flex;\n      width: 100%;\n      height: 4px;\n      background-color: transparent;\n      transition: background-color 0.2s ease;\n      position: absolute;\n      left: 0;\n      right: 0; }\n    .ht_dragZone .ht_dragZoneItem.ht_dragZoneItemSelected::after {\n      background-color: rgba(102, 143, 255, 0.25); }\n    .ht_dragZone .ht_dragZoneItem:nth-of-type(1)::after {\n      top: 0; }\n    .ht_dragZone .ht_dragZoneItem:nth-of-type(2)::after {\n      top: 50%;\n      transform: translateY(-50%); }\n    .ht_dragZone .ht_dragZoneItem:nth-of-type(3)::after {\n      bottom: 0; }\n");var K=function(t){var n,r,i,o,a=t.depth,s=t.depthGap,d=t.isDragging,l=t.node,h=t.onDragEnterAfter,p=t.onDragEnterBefore,u=t.onDragEnterChildren,g=t.onDragLeave;return e.createElement("div",{className:f((n={},n[S.dragZone]=!0,n[S.dragZoneVisible]=!!d,n)),style:{marginLeft:c(a,s)},onDragLeave:g},e.createElement("div",{className:f((r={},r[S.dragZoneItem]=!0,r[S.dragZoneItemSelected]="before"===l.getNodeDropContainer(),r)),onDragEnter:p}),e.createElement("div",{className:f((i={},i[S.dragZoneItem]=!0,i[S.dragZoneItemSelected]="children"===l.getNodeDropContainer(),i)),onDragEnter:u}),e.createElement("div",{className:f((o={},o[S.dragZoneItem]=!0,o[S.dragZoneItemSelected]="after"===l.getNodeDropContainer(),o)),onDragEnter:h}))},x={hyperTreeView:"ht_hyperTreeView",hyperTreeNodeWrapper:"ht_hyperTreeNodeWrapper",hyperNodeWrapper:"ht_hyperNodeWrapper",child:"ht_child",collapsed:"ht_collapsed",selected:"ht_selected"};g(".ht_hyperTreeView .ht_hyperTreeNodeWrapper {\n  position: relative; }\n  .ht_hyperTreeView .ht_hyperTreeNodeWrapper .ht_hyperNodeWrapper {\n    position: relative;\n    opacity: 1; }\n  .ht_hyperTreeView .ht_hyperTreeNodeWrapper .ht_child {\n    position: relative;\n    transition: all 0.2s ease;\n    transform-origin: top;\n    transform-style: flat;\n    max-height: 99999px;\n    transform: scaleY(1);\n    opacity: 1;\n    visibility: visible; }\n    .ht_hyperTreeView .ht_hyperTreeNodeWrapper .ht_child.ht_collapsed {\n      transition: all 0.2s cubic-bezier(0, 1, 0, 1);\n      transform: scaleY(0);\n      max-height: 0;\n      opacity: 0;\n      visibility: hidden;\n      overflow: hidden; }\n\n.ht_selected {\n  background-color: rgba(255, 0, 0, 0.2); }\n");var I=e.forwardRef((function(t,n){var r,i,a=t.classes,s=void 0===a?p.classes:a,d=t.depth,l=t.depthGap,h=void 0===l?p.depthGap:l,u=t.disableHorizontalLines,g=t.disableLines,y=t.displayedName,v=void 0===y?p.displayedName:y,m=t.draggable,C=t.draggableHandlers,b=t.gapMode,N=void 0===b?p.gapMode:b,D=t.horizontalLineStyles,L=t.isDragging,O=t.node,E=t.renderDragZone,S=t.renderNode,I=t.setOpen,T=t.setSelected,Z=t.staticNodeHeight,k=t.verticalLineOffset,H=void 0===k?p.verticalLineOffset:k,P=e.useCallback((function(e){e.stopPropagation(),I&&I(O)}),[O,I]),A=e.useCallback((function(){T&&T(O,!O.isSelected())}),[O,T]),B={};Z&&(B.height="".concat(Z,"px"));var W="padding"===N?"paddingLeft":"marginLeft",U=e.useCallback((function(e){return C.handleDragEnter(O,e)}),[C,O]);return e.createElement("div",{draggable:m,onDragStart:m?C.handleDragStart:void 0,onDragEnd:m?C.handleDrop(O,O.getNodeDropContainer()):void 0,className:f((r={},r[x.hyperNodeWrapper]=!0,r[x.selected]=O.isSelected(),r[x.dropContainer]=!!O.getNodeDropContainer(),r[s.nodeWrapper||""]=!!s.nodeWrapper,r[s.selectedNodeWrapper||""]=!(!s.selectedNodeWrapper||!O.isSelected()),r)),style:o((i={},i[W]=c(d,h),i),B),ref:n},m&&E?E({depth:d,depthGap:h,isDragging:L,node:O,onDragEnterAfter:U("after"),onDragEnterBefore:U("before"),onDragEnterChildren:U("children"),onDragLeave:C.handleDragLeave(O)}):m&&e.createElement(K,{depth:d,depthGap:h,isDragging:L,node:O,onDragEnterAfter:U("after"),onDragEnterBefore:U("before"),onDragEnterChildren:U("children"),onDragLeave:C.handleDragLeave(O)}),S?S({depth:d,depthGap:h,displayedName:v,node:O,nodeRef:n,offsetProp:W,onSelect:A,onToggle:P}):e.createElement(_,{displayedName:v,node:O,onSelect:A,onToggle:P}),!O.options.root&&!(g||u)&&e.createElement(w,{depth:d,depthGap:h,gapMode:N,horizontalLineStyles:D,verticalLineOffset:H}))})),T=function(t){var n,r=t.classes,i=void 0===r?p.classes:r,s=t.depth,d=t.depthGap,l=void 0===d?p.depthGap:d,c=t.disableLines,h=t.disableTransitions,u=t.disableVerticalLines,g=t.node,y=t.nodeHeight,v=t.verticalLineOffset,m=t.verticalLineStyles,C=t.verticalLineTopOffset,b=a(t,["classes","depth","depthGap","disableLines","disableTransitions","disableVerticalLines","node","nodeHeight","verticalLineOffset","verticalLineStyles","verticalLineTopOffset"]);return g.hasChildren()?!g.isOpened()&&h?null:e.createElement("div",{className:f((n={},n[x.child]=!0,n[x.collapsed]=!g.isOpened(),n[i.children||""]=!!i.children,n[i.collapsedChildren||""]=!(!i.collapsedChildren||g.isOpened()),n))},e.createElement(Z,o({classes:i,data:g.getChildren(),depth:s+1,depthGap:l,disableLines:c,disableVerticalLines:u,disableTransitions:h,nodeHeight:y,verticalLineOffset:v,verticalLineStyles:m,verticalLineTopOffset:C},b)),!(c||u)&&e.createElement(O,{count:g.options.currentChilrenCount,depth:s,depthGap:l,nodeHeight:y,disableTransitions:h,verticalLineOffset:v,verticalLineStyles:m,verticalLineTopOffset:C})):null},Z=e.forwardRef((function(t,n){var r=t.classes,i=void 0===r?p.classes:r,s=t.data,d=t.depth,l=void 0===d?0:d,c=a(t,["classes","data","depth"]);return e.createElement("div",{className:f(x.hyperTreeView,i.level)},s.map((function(t){return e.createElement("div",{key:t.getReactKey(),className:f(x.hyperTreeNodeWrapper,i.parentChildren)},e.createElement(I,o({classes:i,depth:l,node:t,ref:n},c)),e.createElement(T,o({classes:i,depth:l,node:t},c)))})))})),k=function(t){var n=t.classes,r=void 0===n?p.classes:n,i=t.staticNodeHeight,s=a(t,["classes","staticNodeHeight"]),d=e.useRef(null),l=e.useState(i||0),c=l[0],h=l[1];return e.useLayoutEffect((function(){d.current&&!i&&setTimeout((function(){var e,t=null===(e=d.current)||void 0===e?void 0:e.getBoundingClientRect();t&&h(t.height)}),100)}),[c,i,d.current]),e.createElement("div",{className:r.treeWrapper},e.createElement(Z,o({classes:r,depth:0,nodeHeight:c,ref:d,staticNodeHeight:i},s)))};function H(e,t){var n,r;if(0===t.length)return e;for(n=0,r=t.length;n<r;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e<0?-2*e:e}function P(e,t,n,r){var i,o=H(H(H(e,n),(i=t,Object.prototype.toString.call(i))),typeof t);if(null===t)return H(o,"null");if(void 0===t)return H(o,"undefined");if("object"==typeof t||"function"==typeof t){if(-1!==r.indexOf(t))return H(o,"[Circular]"+n);r.push(t);var a=function(e,t,n){return Object.keys(t).sort().reduce((function(e,r){return P(e,t[r],r,n)}),e)}(o,t,r);if(!("valueOf"in t)||"function"!=typeof t.valueOf)return a;try{return H(a,String(t.valueOf()))}catch(e){return H(a,"[valueOf exception]"+(e.stack||e.message))}}return H(o,t.toString())}var A=function(e){return function(e,t){for(;e.length<t;)e="0"+e;return e}(P(0,e,"",[]).toString(16),8)},B=function(){function e(e,t,n){this.data=e,this.asyncNode=!!e.getChildren,this.asyncDataLoaded=!1,this.id=e[t.idKey],this.options=t,this.children=n}return e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getChildren=function(){return this.children||[]},e.prototype.setNodeChildren=function(e,t,n){return!this.hasChildren()||n?(this.setChildren(this.setNodesParent(e,this)),this.getChildren()):"first"===t?(this.setChildren(this.setNodesParent(l(l([],e,!0),this.children||[],!0),this)),this.getChildren()):(this.setChildren(this.setNodesParent(l(l([],this.children||[],!0),e,!0),this)),this.getChildren())},e.prototype.removeChild=function(e){this.setChildren(this.getChildren().filter((function(t){return t.id!==e.id})))},e.prototype.setChildren=function(e){this.children=this.setNodesParent(e,this)},e.prototype.hasChildren=function(){return this.children&&0!==this.children.length},e.prototype.getParent=function(){return this.options.parent},e.prototype.setParent=function(e){this.options.parent=e},e.prototype.setNodesParent=function(e,t){return e.map((function(e){return e.setParent(t),e}))},e.prototype.setChildrenCount=function(e){this.options.childrenCount=e},e.prototype.getFirstChild=function(){return this.getChildren()[0]||null},e.prototype.getLastChild=function(){return this.children&&0!==this.children.length?this.children[this.children.length-1]:null},e.prototype.setOpened=function(e){this.options.opened=e||!1},e.prototype.isOpened=function(){return this.options.opened},e.prototype.setLoading=function(e){this.options.loading=e||!1},e.prototype.isLoading=function(){return this.options.loading},e.prototype.setSelected=function(e){this.options.selected=e||!1},e.prototype.isSelected=function(){return this.options.selected},e.prototype.setPath=function(e){this.options.path="".concat(e,"/").concat(this.id)},e.prototype.getPath=function(e){return e?this.options.path.split("/").filter((function(e){return!!e})):this.options.path},e.prototype.setNodeDropContainer=function(e){void 0===e&&(e=!1),this.options.dropContainer=e},e.prototype.getNodeDropContainer=function(){return this.options.dropContainer},e.prototype.getReactKey=function(){return this.options.reactKey},e.prototype.setAsyncDataLoaded=function(e){this.asyncDataLoaded=e},e.prototype.isAsyncDataLoaded=function(){return this.asyncDataLoaded},e}(),W=function(){function e(e,t,n){this.id=e,this.data=t,this.options=n,this.enhancedData=[],this.ids=[],n.enhance&&this.enhance()}return e.prototype.on=function(e){e()},e.prototype.sort=function(e){return e.sort(this.options.sort),e},e.prototype.staticEnhance=function(e,t){var n;return t instanceof B?n=t:t&&(n=this.getNodeById(t)),this._staticEnhance(e,n)},e.prototype.enhance=function(e){return this.enhancedData=this._enhance(e||this.data,this.options),this.enhancedData},e.prototype.enhanceNodes=function(e){var t=this;void 0===e&&(e=!1),e&&(this.enhancedData=this._staticShallowEnahance(this.enhancedData)),this.traverse((function(e){t._calculateChildrenCount(e)}),!1)},e.prototype.flat=function(e){var t=e?this.data:this.enhancedData;return this.flatData=this._flat(t),this.ids=this.flatData.map((function(e){return e.id})),this.flatData},e.prototype.selectAll=function(){this.traverse((function(e){e.setSelected(!0)}))},e.prototype.unselectAll=function(){this.traverse((function(e){e.setSelected(!1)}))},e.prototype.getOpenedNodes=function(){var e=[];return this.traverse((function(t){t.isOpened()&&e.push(t)})),e},e.prototype.addChildren=function(e,t,n){void 0===n&&(n="first"),this._addChildren(this.data,e,t,n)},e.prototype.addSibling=function(e,t,n){void 0===n&&(n="after"),this._addSibling(this.data,e,t,n)},e.prototype.remove=function(e,t){this._remove(this.data,null,e,t)},e.prototype.traverseRaw=function(e,t){void 0===t&&(t=!0),t?this._traverseDeep(this.data,e):this._traverseBreadth(this.data,e)},e.prototype.traverse=function(e,t){void 0===t&&(t=!0),t?this._traverseDeep(this.enhancedData,e):this._traverseBreadth(this.enhancedData,e)},e.prototype.getNodeById=function(e){return this._getNodeById(e,this.enhancedData)},e.prototype._addChildren=function(e,t,n,r){for(var i=0;i<e.length;i+=1){if(e[i][this.options.idKey]===t)switch(r){case"first":return void(e[i][this.options.childrenKey]=l(l([],n,!0),e[i][this.options.childrenKey]||[],!0));case"last":return void(e[i][this.options.childrenKey]=l(l([],e[i][this.options.childrenKey]||[],!0),n,!0));default:return}else if(e[i][this.options.childrenKey]&&0!==e[i][this.options.childrenKey].length)return void this._addChildren(e[i][this.options.childrenKey],t,n,r);return}},e.prototype._addSibling=function(e,t,n,r){for(var i=this,o=0;o<e.length;o+=1){if(e[o][this.options.childrenKey]&&0!==e[o][this.options.childrenKey].length){var a=e[o][this.options.childrenKey].findIndex((function(e){return e[i.options.idKey]===t}));if(a>-1)return void e[o][this.options.childrenKey].splice("before"===r?a:a+1,0,n);this._addSibling(e[o][this.options.childrenKey],t,n,r)}return}},e.prototype._flat=function(e){var t=this,n=[];return e.forEach((function(e){var r=e.children,i=a(e,["children"]);n.push(i),r&&0!==r.length&&n.push.apply(n,t._flat(r))})),n},e.prototype._enhance=function(e,t,n){var r=this,i=[];return this.sort(e).forEach((function(e,o){var a,s=e[r.options.childrenKey]&&0!==e[r.options.childrenKey].length?e[r.options.childrenKey]:[],d=!1;"boolean"==typeof t.defaultOpened&&(d=t.defaultOpened),Array.isArray(t.defaultOpened)&&(d=t.defaultOpened.includes(e[t.idKey]));var l=new B(e,{opened:d,selected:!1,root:!n,leaf:!s,hasChildren:0!==s.length,async:!!e.getChildren,parent:n,childrenCount:0,currentChilrenCount:0,loading:!1,idKey:r.options.idKey,childrenKey:r.options.childrenKey,path:"",dropContainer:!1,reactKey:""});l.setPath(n?n.options.path:""),l.options.reactKey="".concat(l[r.options.idKey],"-").concat(l.getPath(),"-").concat(o);var c=[];if(0!==s.length&&(c=r._enhance(r.sort(s),t,l),t.filter&&0!==c.length&&0!==(c=c.filter((function(e){return!!e.getChildren().some((function(e){return e.isOpened()}))||t.filter&&t.filter(e)}))).length))for(var h=0;h<c.length;h+=1)c[h].setOpened(!0),c[h].options.parent&&(null===(a=c[h].options.parent)||void 0===a||a.setOpened(!0));l.options.leaf&&l.setOpened(!0),l.setChildren(c),r._calculateChildrenCount(l),(!t.filter||!l.options.leaf||t.filter&&t.filter(l))&&i.push(l)})),i},e.prototype._staticEnhance=function(e,t){var n=this,r=[];return e.forEach((function(e,i){var o=e[n.options.childrenKey]||[],a=new B(e,{opened:!1,selected:!1,root:!t,leaf:0===o.length,hasChildren:0!==o.length,async:!!e.getChildren,parent:t,childrenCount:0,currentChilrenCount:0,loading:!1,idKey:n.options.idKey,childrenKey:n.options.childrenKey,path:"",dropContainer:!1,reactKey:""});a.setPath(t?t.options.path:""),a.options.reactKey="".concat(a[n.options.idKey],"-").concat(a.getPath(),"-").concat(i);var s=[];0!==o.length&&(s=n._staticEnhance(o,a)),a.setChildren(s),n._calculateChildrenCount(a),r.push(a)})),r},e.prototype._staticShallowEnahance=function(e,t){var n=this,r=[];return e.forEach((function(e){var i=e[n.options.childrenKey]||[];e.options.parent=t,e.setPath(t?t.options.path:"");var o=[];0!==i.length&&(o=n._staticShallowEnahance(i,e)),e.setChildren(o),n._calculateChildrenCount(e),r.push(e)})),r},e.prototype._calculateChildrenCount=function(e){var t=e.getChildren().reduce((function(e,t){return t.isOpened()?e+=t.options.childrenCount:e}),0);e.isOpened()?e.options.childrenCount=e.getChildren().length+t:e.options.childrenCount=e.getChildren().length;var n=e.getLastChild();if(n&&n.isOpened()){var r=e.options.childrenCount;e.options.currentChilrenCount=r-n.options.childrenCount}else e.options.currentChilrenCount=e.options.childrenCount},e.prototype._remove=function(e,t,n,r){for(var i=0;i<e.length;i+=1){if(e[i][this.options.idKey]===n){var o=e[i];return e.splice(i,1),void(t&&o[this.options.childrenKey]&&0!==o[this.options.childrenKey].length&&r&&(t[this.options.childrenKey]="start"===r?l(l([],o[this.options.childrenKey],!0),t[this.options.childrenKey]||[],!0):l(l([],t[this.options.childrenKey]||[],!0),o[this.options.childrenKey],!0)))}e[i][this.options.childrenKey]&&0!==e[i][this.options.childrenKey].length&&this._remove(e[i][this.options.childrenKey],e[i],n,r)}},e.prototype._getNodeById=function(e,t){for(var n=0;n<t.length;n+=1){if("".concat(t[n][this.options.idKey]).toLowerCase()==="".concat(e).toLowerCase())return t[n];if(t[n][this.options.childrenKey]&&0!==t[n][this.options.childrenKey].length){var r=this._getNodeById(e,t[n][this.options.childrenKey]);if(r)return r}}return null},e.prototype._traverseDeep=function(e,t,n){var r=this;void 0===n&&(n=0),e.forEach((function(e,i){t(e,i,n),e.children&&0!==e.children.length&&r._traverseDeep(e.children,t,n+1)}))},e.prototype._traverseBreadth=function(e,t,n){var r=this;void 0===n&&(n=0),e.forEach((function(e,i){e.children&&0!==e.children.length&&r._traverseBreadth(e.children,t,n+1),t(e,i,n)}))},e}(),U=new(function(){function e(){this.trees={}}return e.prototype.getIds=function(){return Object.keys(this.trees)},e.prototype.safeUpdate=function(e,t){return this.trees[e]?(this.trees[e].instance=t,this.trees[e].handlers={}):this.trees[e]={instance:t,handlers:{}},this},e.prototype.remove=function(e){var t=this.trees,n=e;t[n];var r=a(t,["symbol"==typeof n?n:n+""]);return this.trees=r,this},e.prototype.safeUpdateHandler=function(e,t,n){var r;return this.trees[e]&&(this.trees[e].handlers=o(o({},this.trees[e].handlers),((r={})[t]=n,r))),this},e.prototype.removeHandler=function(e,t){if(this.trees[e]){var n=this.trees[e].handlers,r=t;n[r];var i=a(n,["symbol"==typeof r?r:r+""]);this.trees[e].handlers=i}return this},e.prototype.updateLoadedData=function(e,t){this.trees[e]&&(this.trees[e].loadedData=t)},e}()),j={sort:function(){return 0}},G=function(e){var o,a=e.id,c=e.data,u=e.filter,f=e.sort,g=e.defaultOpened,y=e.multipleSelect,v=e.refreshAsyncNodes,m=e.idKey,C=void 0===m?p.idKey:m,b=e.childrenKey,N=void 0===b?p.childrenKey:b,_=(o=t(Object.create(null))[1],i((function(e){e&&e(),o(Object.create(null))}),[o])),D=t(null),L=D[0],O=D[1],E=t(!1),w=E[0],S=E[1],K=t(!1),x=K[0],I=K[1],T=t([]),Z=T[0],k=T[1],H=t(!1),P=H[0],G=H[1];n((function(){var e=Array.isArray(c)?c:[c];A(e)!==A(Z)&&k(e)}),[c,Z]);var V=r((function(){return new W(a,Z,{idKey:C,childrenKey:N,defaultOpened:!1,filter:u,enhance:!0,sort:f||j.sort})}),[a,Z,C,N,u,f]),z=i((function(e){return e instanceof B?e:V.getNodeById(e)||null}),[V]),M=i((function(e,t){if(e instanceof B)e.setLoading(t),_();else{var n=V.getNodeById(e);n&&(n.setLoading(t),_())}}),[_,V]),R=i((function(e,t){!y&&t&&V.unselectAll();var n=z(e);n&&(n.setSelected(t),_())}),[_,V,y,z]),F=i((function(e,t){if(e instanceof B)e.setNodeDropContainer(t),_();else{var n=V.getNodeById(e);n&&(n.setNodeDropContainer(t),_())}}),[_,V]),Y=i((function(e,t,n,r){if(e instanceof B)e.setNodeChildren(t,n,r),V.enhanceNodes(),_();else{var i=V.getNodeById(e);i&&(i.setNodeChildren(t,n,r),V.enhanceNodes(),_())}}),[V,_]),q=i((function(e,t,n){var r,i=z(e);if(i&&i.options.parent){var o,a=l([],i.options.parent.getChildren(),!0);if(-1!==(o=a.findIndex((function(e){return i&&e.id===i.id})))){var s="before"===n?o:o+1;a.splice.apply(a,l([s,0],t,!1)),i.options.parent.setNodeChildren(a,"first",!0),V.enhanceNodes(!0),_()}}if(i&&i.options.root&&-1!==(o=V.enhancedData.findIndex((function(e){return i&&i.id===e.id})))){s="before"===n?o:o+1;var d=t.map((function(e){return e.options.parent=void 0,e.options.root=!0,e.options.leaf=!1,e}));(r=V.enhancedData).splice.apply(r,l([s,0],d,!1)),V.enhanceNodes(!0),_()}}),[V,_,z]),J=i((function(e,t,n,r){Y(e,V.staticEnhance(t,e),n,r)}),[Y,V]),Q=i((function(e,t){var n=z(e);n&&(n.setData(t),_((function(){V.enhanceNodes()})))}),[_,V,z]),X=i((function(e){var t=z(e);if(t)return t.getData()}),[z]),$=i((function(e,t){return void 0===t&&(t=!0),s(void 0,void 0,void 0,(function(){var n,r,i;return d(this,(function(o){switch(o.label){case 0:if(!(n=z(e)))return[2];if(!n.data.getChildren||!h(n.data.getChildren)||n.isOpened()||n.isAsyncDataLoaded())return[3,5];M(n,!0),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.data.getChildren({node:e})];case 2:return r=o.sent(),M(e,!1),n.setOpened(!0),v||n.setAsyncDataLoaded(!0),J(e,r,"last",!0),[3,4];case 3:return i=o.sent(),console.error("react-hyper-tree: Error on getChildren",i),[3,4];case 4:return[3,6];case 5:n.setOpened(!t||!n.isOpened()),V.enhanceNodes(),o.label=6;case 6:return _((function(){V.enhanceNodes()})),[2]}}))}))}),[z,_,M,v,J,V]),ee=i((function(e){return s(void 0,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,e.split("/").reduce((function(e,t){return s(void 0,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,$(t)];case 2:return n.sent(),[2]}}))}))}),Promise.resolve())];case 1:return t.sent(),[2]}}))}))}),[$]),te=i((function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),s(void 0,void 0,void 0,(function(){var r,i,o,a;return d(this,(function(s){switch(s.label){case 0:r=e.split("/"),i=0,s.label=1;case 1:return i<r.length?(o=r[i])&&(a=z(o))?a.isOpened()?[3,3]:[4,$(a)]:[3,4]:[3,5];case 2:s.sent(),s.label=3;case 3:(t||i===r.length-1)&&R(a,!n||!a.isSelected()),s.label=4;case 4:return i+=1,[3,1];case 5:return V.enhanceNodes(),_(),[2]}}))}))}),[_,z,$,R,V]),ne=i((function(){y&&(V.selectAll(),V.enhanceNodes(),_())}),[V,_,y]),re=i((function(){V.unselectAll(),V.enhanceNodes(),_()}),[V,_]);n((function(){var e=function(){return s(void 0,void 0,void 0,(function(){var e,t,n,r;return d(this,(function(i){switch(i.label){case 0:if(G(!0),e=!1,0===(t=V.flat()).length)return[2];n=0,i.label=1;case 1:return n<t.length?(r=t[n],"boolean"!=typeof g?[3,3]:[4,$(r.id,!1)]):[3,7];case 2:return i.sent(),[3,5];case 3:return(null==g?void 0:g.includes(r.id))?[4,$(r.id,!1)]:[3,5];case 4:i.sent(),i.label=5;case 5:r.data.getChildren&&(e=!0),i.label=6;case 6:return n+=1,[3,1];case 7:if(!e)return[3,13];t=V.flat(),n=0,i.label=8;case 8:return n<t.length?(r=t[n],"boolean"!=typeof g?[3,10]:[4,$(r.id,!1)]):[3,13];case 9:return i.sent(),[3,12];case 10:return(null==g?void 0:g.includes(r.id))?[4,$(r.id,!1)]:[3,12];case 11:i.sent(),i.label=12;case 12:return n+=1,[3,8];case 13:return[2]}}))}))};if(!P&&void 0!==g&&0!==V.flat().length){var t="boolean"==typeof g;t&&g&&e(),t||0===g.length||e()}}),[g,P,$,V]);var ie=i((function(e){e.stopPropagation(),S(!0)}),[]),oe=i((function(e,t){return function(n){n.stopPropagation(),n.preventDefault(),F(e,t),O(e.id),I(t)}}),[F]),ae=i((function(e){return function(t){t.stopPropagation(),t.preventDefault(),e.id!==L&&F(e,!1)}}),[F,L]),se=i((function(e,t){var n;return!(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.parent)||t.options.parent.id!==e.id&&se(e,z(t.options.parent))}),[z]),de=i((function(e){return function(t){if(t.stopPropagation(),t.preventDefault(),S(!1),L&&F(L,!1),L&&L!==e.id){var n=V.getNodeById(L);if(e){if(!se(e,n))return;e.options.parent?e.options.parent.removeChild(e):V.enhancedData=V.enhancedData.filter((function(t){return t.id!==e.id})),"children"===x?(e.options.parent=n,e.options.root=!1,e.options.leaf=!0,n.setNodeChildren([e],"last"),V.enhanceNodes(!0),_()):"after"!==x&&"before"!==x||q(n,[e],x),O(null)}}}}),[L,_,V,F,q,x,se]);U.safeUpdate(a,V).safeUpdateHandler(a,"rerender",_).safeUpdateHandler(a,"setOpen",$).safeUpdateHandler(a,"setOpenByPath",ee).safeUpdateHandler(a,"setLoading",M).safeUpdateHandler(a,"setSelected",R).safeUpdateHandler(a,"setSelectedByPath",te).safeUpdateHandler(a,"setRawChildren",J).safeUpdateHandler(a,"setChildren",Y).safeUpdateHandler(a,"setSiblings",q).safeUpdateHandler(a,"getNode",z).safeUpdateHandler(a,"setNodeData",Q).safeUpdateHandler(a,"getNodeData",X).safeUpdateHandler(a,"selectAll",ne).safeUpdateHandler(a,"unselectAll",re);var le=r((function(){return{setChildren:Y,setLoading:M,setOpen:$,setRawChildren:J,setSelected:R,setSiblings:q,setNodeData:Q,getNode:z,getNodeData:X,selectAll:ne,unselectAll:re,draggableHandlers:{handleDragStart:ie,handleDragEnter:oe,handleDragLeave:ae,handleDrop:de}}}),[oe,ae,ie,de,Y,M,$,J,R,q,Q,z,X,ne,re]);return{instance:V,handlers:le,required:{isDragging:w,data:V.enhancedData}}};export{m as Arrow,_ as DefaultNode,K as DragZone,w as HorizontalLine,b as Loader,k as Tree,O as VerticalLine,k as default,U as treeHandlers,G as useTreeState};
//# sourceMappingURL=index.es.js.map
